<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSV Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    #dashboard { display: none; }
    #error { color: red; }
    table { border-collapse: collapse; }
    th, td { border: 1px solid #aaa; padding: 6px 12px; }
    th { background: #eee; }
  </style>
</head>
<body>
  <div id="dashboard">
    <h1>CSV Dashboard</h1>
    <div id="table"></div>
  </div>
  <div id="error"></div>
  <script>
    // -- PASSWORD-PROTECTED DASHBOARD LOGIC --
    const PASSWORD = "LetMeIn"; // change this to your password

    async function promptForPassword() {
      for (let i = 0; i < 3; i++) {
        const input = window.prompt("Please enter the password:");
        if (input === null) {
          showError("Access cancelled.");
          return false;
        }
        if (input === PASSWORD) return true;
        alert("Incorrect password, try again!");
      }
      showError("Too many incorrect attempts. Access denied.");
      return false;
    }

    function showError(msg) {
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('error').textContent = msg;
    }

    // -- CSV LOADING --
    async function fetchCSV(url) {
      try {
        const response = await fetch(url);
        if (!response.ok)
          throw new Error(`HTTP ${response.status} - ${response.statusText}`);
        return await response.text();
      } catch (err) {
        throw new Error("Failed to fetch data.csv: " + err.message);
      }
    }

    // Basic CSV parser: assumes no quoted fields or newlines inside fields
    function parseCSV(text) {
      const lines = text.trim().split(/\r?\n/);
      if (lines.length === 0) throw new Error("CSV is empty.");
      const headers = lines[0].split(",");
      const rows = lines.slice(1).map(line => line.split(","));
      return { headers, rows };
    }

    function renderTable({headers, rows}) {
      const tableDiv = document.getElementById('table');
      let html = "<table><thead><tr>";
      for (const h of headers) html += `<th>${h}</th>`;
      html += "</tr></thead><tbody>";
      for (const row of rows) {
        html += "<tr>";
        for (const val of row) html += `<td>${val}</td>`;
        html += "</tr>";
      }
      html += "</tbody></table>";
      tableDiv.innerHTML = html;
    }

    // -- MAIN LOGIC --
    window.addEventListener('DOMContentLoaded', async () => {
      document.getElementById('error').textContent = "";
      document.getElementById('dashboard').style.display = 'none';

      // Step 1: Password protection
      const access = await promptForPassword();
      if (!access) return;

      // Step 2: Fetch & display CSV
      try {
        const csvText = await fetchCSV("data.csv");
        const data = parseCSV(csvText);
        renderTable(data);
        document.getElementById('dashboard').style.display = '';
      } catch (e) {
        showError(e.message + "\n\nMake sure data.csv exists in this directory and is readable.");
      }
    });
  </script>
</body>
</html>
